<!DOCTYPE html>

<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>GENESIS – Outil d'analyse des entêtes de courrier électroniques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://www.interieur.gouv.fr/themes/custom/dsfr/src/images/logo/favicon.png">

  <!-- DSFR -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/utility/utilities.min.css">

  <style>
    body { margin: 0; background: #fff; }
    .fr-header, .fr-header__brand { filter: none !important; }

    .genesis-main {
      padding: 2rem 0;
    }

    .genesis-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    textarea {
      min-height: 360px;
      font-family: monospace;
    }

    .results {
      min-height: 360px;
      padding: 1rem;
      border: 1px solid var(--border-default-grey);
      background: var(--background-alt-grey);
      overflow-y: auto;
    }
  </style>

</head>

<body>

<!-- HEADER OFFICIEL -->

<header role="banner" class="fr-header">
  <div class="fr-header__body">
    <div class="fr-container">
      <div class="fr-header__body-row">
        <div class="fr-header__brand fr-enlarge-link">
          <div class="fr-header__brand-top">
            <div class="fr-header__logo">
              <p class="fr-logo">Ministère<br>de l’Intérieur</p>
            </div>
          </div>
          <div class="fr-header__service">
            <p class="fr-header__service-title">GENESIS</p>
            <p class="fr-header__service-tagline">
              Outil d’analyse des entêtes de courriers électroniques
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- APPLICATION -->

<main class="genesis-main">
  <div class="fr-container">


<div class="genesis-grid">

  <button id="btn-tuto" class="fr-btn fr-btn--secondary fr-mb-2w">
  Tutoriel
</button>

<div id="view-analyse">
  <!--INTERFACE D'ANALYSE -->

  <!-- GAUCHE -->
  <section>
        <h2 class="fr-h5">Texte à analyser</h2>
    <textarea
      id="inputText"
      class="fr-input"
      placeholder="Collez ici l’entête brute du courrier électronique…"></textarea>

<fieldset class="fr-fieldset fr-mt-2w">
  <legend class="fr-fieldset__legend">
    Types d’éléments à extraire
  </legend>

  <div class="fr-fieldset__content">

    <div class="fr-checkbox-group fr-mb-1w">
      <input type="checkbox" id="chk-ip">
      <label for="chk-ip">Adresses IP</label>
    </div>

    <div class="fr-checkbox-group">
      <input type="checkbox" id="chk-mail">
      <label for="chk-mail">Adresses e-mail</label>
    </div>

  </div>
</fieldset>

    <button id="btn-analyze" class="fr-btn fr-mt-2w">
      Analyser
    </button>
  </section>

  <!-- DROITE -->
  <section>
    <h2 class="fr-h5">Résultats</h2>
    <div id="results" class="results fr-text--sm">
      Aucun résultat pour le moment.
    </div>
  </section>

</div>


  </div>

  <!-- VUE TUTORIEL -->

</div>
<div id="view-tuto" hidden>

  <!-- En-tête avec flèche retour -->
  <div class="fr-container fr-mt-2w">
    <button id="btn-back" class="fr-btn fr-btn--tertiary fr-btn--icon-left fr-icon-arrow-left-line">
      Retour
    </button>
  </div>

  <!-- Contenu tutoriel -->
  <div class="fr-container fr-mt-4w">

    <h1 class="fr-h3">
      Comment récupérer l’entête d’un courrier électronique
    </h1>

    <p>
      Pour analyser un message, GENESIS a besoin de son <strong>entête complète</strong>.
    </p>

    <ol class="fr-mt-2w">
      <li>Ouvrez le courrier électronique</li>
      <li>Utilisez le raccourci <strong>Ctrl + U</strong></li>
      <li>Copiez l’intégralité du contenu affiché</li>
      <li>Revenez sur GENESIS</li>
      <li>Collez le contenu dans le champ « Texte à analyser »</li>
    </ol>

  </div>

</div>

</main>

<!-- DSFR JS -->

<script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.module.min.js" type="module"></script>

<script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.nomodule.min.js" nomodule></script>

<script>
  const REGEX_IP = /\b(?:\d{1,3}\.){3}\d{1,3}\b/g;
  const REGEX_MAIL = /\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b/g;

  document.getElementById('btn-analyze').addEventListener('click', () => {
    const text = document.getElementById('inputText').value;
    const wantIP = document.getElementById('chk-ip').checked;
    const wantMail = document.getElementById('chk-mail').checked;
    const output = document.getElementById('results');

    output.innerHTML = '';

    if (!wantIP && !wantMail) {
      output.textContent = 'Sélectionnez au moins un type d’analyse.';
      return;
    }

    let blocks = [];

    if (wantIP) {
      const ips = text.match(REGEX_IP) || [];
      const ipsUniquesTriees = [...new Set(ips)].sort();

      blocks.push(
        `<strong>Adresses IP (${ipsUniquesTriees.length})</strong><br>` +
        (ipsUniquesTriees.length ? ipsUniquesTriees.join('<br>') : 'Aucune')
      );
    }

    if (wantMail) {
      const mails = text.match(REGEX_MAIL) || [];
      const mailsUniquesTries = [...new Set(mails)].sort();

      blocks.push(
        `<strong>Adresses e-mail (${mailsUniquesTries.length})</strong><br>` +
        (mailsUniquesTries.length ? mailsUniquesTries.join('<br>') : 'Aucune')
      );
    }

    output.innerHTML = blocks.join('<br><br>');
  });
</script>

<script>
  const viewAnalyse = document.getElementById('view-analyse');
  const viewTuto = document.getElementById('view-tuto');

  const btnTuto = document.getElementById('btn-tuto');
  const btnBack = document.getElementById('btn-back');

  btnTuto.addEventListener('click', () => {
    viewAnalyse.hidden = true;
    viewTuto.hidden = false;
    window.scrollTo(0, 0);
  });

  btnBack.addEventListener('click', () => {
    viewTuto.hidden = true;
    viewAnalyse.hidden = false;
    window.scrollTo(0, 0);
  });
</script>

</body>
</html>
